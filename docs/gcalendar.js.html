<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: gcalendar.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: gcalendar.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* ======================================================= */
/* Third Party API - Google Calendar
/* ======================================================= */

"use strict";

// set jshint to ignore console, alert, etc
/* jshint devel : true */
// set jshint to ignore external globals
/* global gCalendarEvent, gapi : false */

// Code Reference: Based on https://developers.google.com/google-apps/calendar/quickstart/js

// Your Client ID can be retrieved from your project in the Google
// Developer Console, https://console.developers.google.com
var GCALENDAR_CLIENT_ID = '1035036075694-1eocpmula50dhlu5t8cmealdhhj70t6b.apps.googleusercontent.com';

//Read/Write Google Calendar Scope required to insert events
var GCALENDAR_SCOPES = ["https://www.googleapis.com/auth/calendar"];

// Debugging of output to console.log
var DEBUG_GCALENDAR = false;


/**
 * Check if current user has authorized this application.
 */
function gCalendarCheckAuth() {
	if (DEBUG_GCALENDAR) {
		console.log("gCalendarCheckAuth: Start - Check if current user has authorized this application.");
	}
	gapi.auth.authorize({
		'client_id': GCALENDAR_CLIENT_ID,
		'scope': GCALENDAR_SCOPES.join(' '),
		'immediate': true
	}, gCalendarHandleAuthResult);
}


/**
 * Handle response from authorization server.
 *
 * @param {Object} authResult Authorization result.
 */
function gCalendarHandleAuthResult(authResult) {
	if (DEBUG_GCALENDAR) {
		console.log("gCalendarHandleAuthResult: Start - Handle response from authorization server.");
	}
	var authorizeElement = document.getElementsByClassName('g-calendar-button');
	console.log(authorizeElement[0]);
	if (authResult &amp;&amp; !authResult.error) {
		// Hide auth UI, then load client library.
		if (DEBUG_GCALENDAR) {
			console.log("gCalendarHandleAuthResult: (authResult &amp;&amp; !authResult.error) Hide auth UI, then load client library.");
		}
		authorizeElement[0].style.display = 'none';
		gCalendarLoadCalendarApi();
	} else {
		if (DEBUG_GCALENDAR) {
			console.log("gCalendarHandleAuthResult: Show auth UI, allowing the user to initiate authorization by clicking authorize button.");
		}
		// Show auth UI, allowing the user to initiate authorization by
		// clicking authorize button.
		authorizeElement[0].style.display = 'inline';
	}
}


/**
 * Initiate auth flow in response to user clicking authorize button.
 *
 * @param {Event} event Button click event.
 */
function gCalendarHandleAuthClick(event) {
	if (DEBUG_GCALENDAR) {
		console.log("gCalendarHandleAuthClick: Start - Initiate auth flow in response to user clicking authorize button.");
	}
	if (typeof gapi === 'undefined') {
		alert("Sorry, Google Calendar has failed to load and can't be accessed. Try reloading this page.");
	} else {
		gapi.auth.authorize({
				client_id: GCALENDAR_CLIENT_ID,
				scope: GCALENDAR_SCOPES,
				immediate: false
			},
			gCalendarHandleAuthResult);
		return false;
	}
}


/**
 * Load Google Calendar client library.
 */
function gCalendarLoadCalendarApi() {
	if (DEBUG_GCALENDAR) {
		console.log("gCalendarLoadCalendarApi: Start - Load Google Calendar client library");
	}
	gapi.client.load('calendar', 'v3', gCalendarInsertEvent);
}


/**
 * makes a request to Google Calendar to insert an event into Primary Calendar of current user
 * requires global gCalendarEvent object
 */
function gCalendarInsertEvent() {
	// Refer to the JavaScript quickstart on how to setup the environment:
	// https://developers.google.com/google-apps/calendar/quickstart/js
	// Change the scope to 'https://www.googleapis.com/auth/calendar' and delete any
	// stored credentials.
	if (DEBUG_GCALENDAR) {
		console.log("gCalendarInsertEvent: Start");
		console.log("gCalendarInsertEvent: gCalendarEvent =");
		console.log(gCalendarEvent);
	}

	var request = gapi.client.calendar.events.insert({
		'calendarId': 'primary',
		'resource': gCalendarEvent
	});

	if (DEBUG_GCALENDAR) {
		console.log("gCalendarInsertEvent: request execute");
	}

	request.execute(function(value) {
		if (DEBUG_GCALENDAR) {
			console.log("gCalendarInsertEvent: value=");
			console.log(value);
		}
		var resultText;
		if (value.error !== undefined) {
			resultText = "Sorry, there was an error trying to add the event into Google Calendar. Google Calendar API Error: " + value.error.code + " - " + value.error.message;
			alert(resultText);
			console.log(resultText);
		} else {
			resultText = 'Success! Event has been added to your calendar: &lt;a href="' + value.htmlLink + '" target="_blank">View&lt;/a>';
			replaceAuthorizeElement(resultText);
			if (DEBUG_GCALENDAR) {
				console.log(resultText);
			}
		}
	});

}


/**
 * Replaces the authorise element contents to the given message.
 *
 * @param {string} message Text to be placed in pre element.
 */
function replaceAuthorizeElement(message) {
	var authorizeElement = document.getElementsByClassName('g-calendar-button');
	console.log(authorizeElement);
	authorizeElement[0].innerHTML = '&lt;p>' + message + '&lt;/p>';
	authorizeElement[0].style.display = 'inline';
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#createEventMarker">createEventMarker</a></li><li><a href="global.html#disableMapMarker">disableMapMarker</a></li><li><a href="global.html#enableMapMarker">enableMapMarker</a></li><li><a href="global.html#gCalendarCheckAuth">gCalendarCheckAuth</a></li><li><a href="global.html#gCalendarHandleAuthClick">gCalendarHandleAuthClick</a></li><li><a href="global.html#gCalendarHandleAuthResult">gCalendarHandleAuthResult</a></li><li><a href="global.html#gCalendarInsertEvent">gCalendarInsertEvent</a></li><li><a href="global.html#gCalendarLoadCalendarApi">gCalendarLoadCalendarApi</a></li><li><a href="global.html#getTimeString">getTimeString</a></li><li><a href="global.html#getUTCDate">getUTCDate</a></li><li><a href="global.html#initMap">initMap</a></li><li><a href="global.html#oEvent">oEvent</a></li><li><a href="global.html#replaceAuthorizeElement">replaceAuthorizeElement</a></li><li><a href="global.html#requestRoutes">requestRoutes</a></li><li><a href="global.html#resizeMap">resizeMap</a></li><li><a href="global.html#viewModel">viewModel</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Jun 09 2016 14:38:28 GMT+1200 (New Zealand Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
